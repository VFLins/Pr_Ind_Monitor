---
title: "Relatório dos produtos encontrados"
author: "Mim"
date: '2022-05-13'
output: 
    html_document:
        theme: readable
        toc: true
        toc_float: true
params:
    database:
        label: "Insira seu banco de dados SQLite gerado pelo Price_indexr"
        value: "*.sqlite"
        input: file
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)

library(dplyr)
library(ggplot2)
library(stringr)
library(plotly)
library(DBI)
library(RSQLite)

conn <- dbConnect(SQLite(), params$database)
tables <- dbListTables(conn)
products <- tables %>%
    str_remove("price_indexr-") %>% str_replace("_", " ") %>% str_to_upper()

datasets <- list()
for (tab in seq_along(tables)) {
    datasets[[products[tab]]] <- dbReadTable(conn, tables[tab])
}
```

``r length(datasets)``

# Histórico de preços individual

```{r, functions}
catHeader <- function(text = "", level = 3) {
    cat(paste0("\n\n", 
               paste(rep("#", level), collapse = ""), 
               " ", text, "\n"))
}
```

### header 1

```{r}
df <- mtcars

pl_list <- list()

pl1 <- qplot(cyl, disp, data = df[1:12,])
pl2 <- qplot(mpg, cyl, data = df[13:20,])
pl3 <- qplot(mpg, cyl, data = df[21:30,])
pl4 <- qplot(mpg, cyl, data = df[1:12,])

pl_list[[1]] <- list(pl1, pl3,  "one")
pl_list[[2]] <- list(pl2, pl4,  "two")
```

## header {.tabset}

```{r, results = "asis", echo = FALSE}

for(i in seq_along(pl_list)){
    tmp <- pl_list[[i]]
    # As you want to use tabset level here has to be lower than 
    # parent level (ie, parent is 2, so here you have to use 3)
    catHeader(tmp[[3]], 3)
    lapply(tmp[1:2], print)
}
```
